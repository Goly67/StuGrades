<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>StuGrade - AutoCalcu</title>
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/218/218656.png">
    <style>
        :root {
            --page-bg-1: #f6f8fc;
            --page-bg-2: #eef3fb;

            --card: #ffffff;
            --card-2: #fbfdff;

            --text: #0f172a;
            --text-2: #334155;
            --muted: #64748b;

            --accent: #2563eb;
            --accent-2: #1d4ed8;

            --danger: #ef4444;

            --border: #e2e8f0;

            --excluded: #ffecec;

            /* Form fields */
            --field-bg: #ffffff;
            --field-text: #0f172a;
            --field-ph: #94a3b8;

            --shadow: 0 14px 36px rgba(15, 23, 42, 0.10);
            --shadow-sm: 0 10px 24px rgba(15, 23, 42, 0.10);

            --radius: 14px;
            --radius-sm: 12px;

            --ring: 0 0 0 4px rgba(37, 99, 235, 0.18);
            --ring-danger: 0 0 0 4px rgba(239, 68, 68, 0.18);

            --font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
        }

        /* Put padding on a wrapper instead of body and let background cover full viewport */
        body {
            font-family: var(--font);
            color: var(--text);
            line-height: 1.45;
            background:
                radial-gradient(900px 600px at 10% 0%, rgba(37, 99, 235, .08), transparent 60%),
                radial-gradient(900px 600px at 90% 10%, rgba(99, 102, 241, .08), transparent 55%),
                linear-gradient(180deg, var(--page-bg-1), var(--page-bg-2));
            background-attachment: fixed;
        }

        /* New wrapper so spacing still feels good on all devices */
        body>.page-shell {
            min-height: 100vh;
            padding:
                max(14px, env(safe-area-inset-top)) max(14px, env(safe-area-inset-right)) max(14px, env(safe-area-inset-bottom)) max(14px, env(safe-area-inset-left));
        }

        /* Optional: keep container as-is */
        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 18px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }


        h1 {
            margin: 2px 0 12px;
            font-size: clamp(18px, 2.4vw, 22px);
            letter-spacing: -0.02em;
            color: var(--text);
        }

        .small {
            font-size: 13px;
            color: var(--muted);
        }

        .legend {
            margin-top: 10px;
            font-size: 13px;
            color: var(--muted);
        }

        /* ---------- Fields ---------- */
        textarea,
        input[type="text"],
        select {
            font-family: var(--font);
            color: var(--field-text);
            background: var(--field-bg);
            border: 1px solid var(--border);
            outline: none;
            transition: border-color .15s ease, box-shadow .15s ease, background-color .15s ease;
        }

        textarea {
            width: 100%;
            min-height: 190px;
            height: 190px;
            padding: 12px;
            border-radius: var(--radius-sm);
            resize: vertical;
            margin-bottom: 10px;
            font-size: 14px;
        }

        textarea::placeholder,
        input::placeholder {
            color: var(--field-ph);
        }

        select {
            padding: 9px 10px;
            border-radius: 12px;
        }

        textarea:focus,
        input[type="text"]:focus,
        select:focus {
            border-color: color-mix(in srgb, var(--accent) 55%, var(--border));
            box-shadow: var(--ring);
        }

        textarea:focus-visible,
        input[type="text"]:focus-visible,
        select:focus-visible,
        button:focus-visible {
            outline: none;
            box-shadow: var(--ring);
        }

        /* IMPORTANT: your subject-name <input> is styled inline via JS;
    these !important rules ensure readable text + correct bg. */
        #grades-table td input[type="text"] {
            width: 100% !important;
            padding: 9px 10px !important;
            border-radius: 12px !important;
            border: 1px solid var(--border) !important;
            background: var(--field-bg) !important;
            color: var(--field-text) !important;
        }

        .grade-input {
            width: 96px;
            padding: 9px 10px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--field-bg);
            color: var(--field-text);
        }

        /* ---------- Controls ---------- */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            margin: 10px 0 12px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: linear-gradient(180deg, var(--card), var(--card-2));
        }

        .controls>button[style*="margin-left:auto"] {
            margin-left: auto !important;
        }

        /* ---------- Buttons ---------- */
        button {
            font-family: var(--font);
            font-size: 14px;
            border-radius: 12px;
            padding: 10px 12px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: transform .08s ease, box-shadow .15s ease, background-color .15s ease, border-color .15s ease, color .15s ease;
            user-select: none;
            touch-action: manipulation;
        }

        button:active {
            transform: translateY(1px);
        }

        button.add-subject-btn {
            background: linear-gradient(180deg, var(--accent), var(--accent-2));
            color: #fff;
            box-shadow: 0 10px 22px rgba(37, 99, 235, 0.18);
        }

        button.add-subject-btn:hover {
            filter: brightness(1.03);
            box-shadow: 0 12px 26px rgba(37, 99, 235, 0.22);
        }

        .delete-btn {
            background: transparent;
            color: var(--text-2);
            border: 1px solid var(--border);
        }

        .delete-btn:hover {
            border-color: color-mix(in srgb, var(--danger) 35%, var(--border));
            color: color-mix(in srgb, var(--danger) 85%, var(--text));
            box-shadow: var(--shadow-sm);
        }

        /* ---------- Table ---------- */
        #grades-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            background: var(--card);
        }

        #grades-table thead th {
            text-align: left;
            font-size: 12.5px;
            letter-spacing: .02em;
            color: var(--muted);
            padding: 12px;
            background: linear-gradient(180deg, var(--card-2), #f6f9ff);
            border-bottom: 1px solid var(--border);
        }

        #grades-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
            font-size: 14px;
            color: var(--text);
        }

        #grades-table tbody tr:nth-child(even) {
            background: #fcfdff;
        }

        #grades-table tbody tr:hover {
            background: color-mix(in srgb, var(--accent) 6%, #ffffff);
        }

        #grades-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Excluded */
        .excluded-row {
            background: var(--excluded) !important;
        }

        .excluded-row td {
            color: var(--excluded-text) !important;
            border-bottom-color: color-mix(in srgb, var(--excluded-border) 70%, var(--border));
        }

        .excluded-row #grades-table td input[type="text"],
        .excluded-row .grade-input {
            background: color-mix(in srgb, #ffffff 55%, var(--excluded)) !important;
            border-color: var(--excluded-border) !important;
            color: #111827 !important;
            /* keep inputs very readable */
        }

        /* Excluded row inputs: force solid background (text + number) */
        .excluded-row input[type="text"],
        .excluded-row input[type="number"] {
            background: color-mix(in srgb, var(--field-bg) 65%, var(--excluded)) !important;
            border-color: color-mix(in srgb, var(--danger) 45%, var(--border)) !important;
            color: var(--field-text) !important;
        }

        /* Also ensure the grade-input class never ends up transparent */
        .excluded-row .grade-input {
            background-color: color-mix(in srgb, var(--field-bg) 65%, var(--excluded)) !important;
        }


        /* ---------- Average box ---------- */
        #average-display {
            margin-top: 18px;
            padding: 14px 18px;
            border-radius: 18px;
            border: 1px solid color-mix(in srgb, var(--accent) 45%, var(--border));
            background:
                radial-gradient(700px 120px at 50% 0%, rgba(37, 235, 67, 0.1), transparent 60%),
                linear-gradient(180deg, var(--card), var(--card-2));
            color: var(--text);
            display: flex;
            flex-direction: column;
            text-align: center;
            gap: 2px;
            font-size: 19px;
            font-weight: 700;
        }

        #average-display::before {
            content: "Great work on tracking your grades ðŸ™Œ";
            font-size: 12px;
            font-weight: 600;
            letter-spacing: .03em;
            text-transform: uppercase;
            color: color-mix(in srgb, #16a34a 70%, var(--text-2));
        }

        #average-display::after {
            content: "Small improvements every quarter lead to big results.";
            font-weight: 500;
            font-size: 12px;
            color: var(--muted);
        }


        /* ---------- Mobile (iPhone/Android) ---------- */
        @media (max-width: 640px) {
            .container {
                padding: 14px;
            }

            .controls {
                padding: 10px;
            }

            /* Make controls stack nicely */
            button.add-subject-btn {
                flex: 1 1 auto;
                min-width: 140px;
            }

            .controls>label {
                width: auto;
            }

            .controls>select {
                flex: 1 1 180px;
            }

            .controls>button[style*="margin-left:auto"] {
                margin-left: 0 !important;
            }

            /* Convert table rows into cards */
            #grades-table {
                border-radius: var(--radius-sm);
            }

            #grades-table thead {
                display: none;
            }

            #grades-table,
            #grades-table tbody {
                display: block;
            }

            #grades-table tbody tr {
                display: grid;
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 12px;
                border-bottom: 1px solid var(--border);
                background: transparent;
            }

            #grades-table td {
                display: grid;
                grid-template-columns: 120px 1fr;
                gap: 10px;
                align-items: center;
                border-bottom: none;
                padding: 0;
            }

            #grades-table td:nth-child(1)::before {
                content: "Subject";
                font-size: 12px;
                color: var(--muted);
            }

            #grades-table td:nth-child(2)::before {
                content: "Grade";
                font-size: 12px;
                color: var(--muted);
            }

            #grades-table td:nth-child(3)::before {
                content: "Status / Action";
                font-size: 12px;
                color: var(--muted);
            }

            .grade-input {
                width: 100%;
            }

            .delete-btn {
                width: max-content;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* ---------- Dark mode ---------- */
        @media (prefers-color-scheme: dark) {
            :root {
                --page-bg-1: #0b1220;
                --page-bg-2: #090f1d;

                --card: #0f172a;
                --card-2: #0b1220;

                --text: #e5e7eb;
                --text-2: #cbd5e1;
                --muted: #94a3b8;

                --border: #22304a;

                --excluded: #2f0606;

                --field-bg: #0b1220;
                --field-text: #e5e7eb;
                --field-ph: #6b7a93;

                --shadow: 0 16px 50px rgba(0, 0, 0, .45);
                --shadow-sm: 0 10px 24px rgba(0, 0, 0, .35);
                --ring: 0 0 0 4px rgba(96, 165, 250, 0.22);
            }

            #grades-table thead th {
                background: linear-gradient(180deg, #0f1a33, #0c152b);
                border-bottom-color: var(--border);
            }

            #grades-table tbody tr:nth-child(even) {
                background: #0b142b;
            }

            #grades-table tbody tr:hover {
                background: color-mix(in srgb, rgba(96, 165, 250, .18) 70%, transparent);
            }
        }

        /* =========================
    Status / Action cleanup
    ========================= */

        /* Make the 3rd column (Status/Action) look structured on desktop */
        @media (min-width: 641px) {
            #grades-table td:nth-child(3) {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                /* consistent spacing */
            }

            #grades-table td:nth-child(3) .delete-btn {
                margin-left: 0 !important;
                /* override inline margin-left:8px */
                flex: 0 0 auto;
            }

            #grades-table td:nth-child(3) .small {
                flex: 1 1 auto;
            }
        }

        /* Turn "Included" / "Excluded..." into a neat pill */
        #grades-table td:nth-child(3) .small {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 9px;
            border: 1px solid var(--border);
            background: color-mix(in srgb, var(--accent) 10%, transparent);
            color: var(--text-2);
            font-weight: 700;
            font-size: 12px;
            line-height: 1.2;
            white-space: normal;
            /* allow wrapping for "Excluded from average" */
        }

        /* Excluded rows: different pill tone */
        .excluded-row td:nth-child(3) .small {
            background: color-mix(in srgb, var(--danger) 10%, transparent);
            border-color: color-mix(in srgb, var(--danger) 25%, var(--border));
            color: color-mix(in srgb, var(--danger) 70%, var(--text));
        }

        /* Mobile card layout fix:
    Prevent the button from falling under the left "label" column (your current "rigged" look). */
        @media (max-width: 640px) {

            /* Force both elements into the right column of the 2-col grid td */
            #grades-table td:nth-child(3) .small,
            #grades-table td:nth-child(3) .delete-btn {
                grid-column: 2;
            }

            /* Stack nicely inside the right column */
            #grades-table td:nth-child(3) .small {
                display: block;
                width: max-content;
                max-width: 100%;
                margin: 0 0 8px 0;
            }

            #grades-table td:nth-child(3) .delete-btn {
                margin-left: 0 !important;
                width: max-content;
                justify-self: start;
            }
        }
    </style>
</head>

<body>
    <div class="page-shell">
        <div class="container">
            <h1>StuGrade â€” AutoCalcu</h1>

            <textarea id="grade-input"
                placeholder="Paste your grades list exactly like the sample you gave (subject line, teacher/date line, then First Quarter / Second Quarter / Final rows)."></textarea>

            <div class="controls">
                <button class="add-subject-btn" onclick="processGrades()">Process Grades</button>
                <button class="add-subject-btn" onclick="addSubject()">Add Subject</button>

                <label class="small" style="margin-left:8px;">Quarter:</label>
                <select id="quarter-select" style="padding:6px;border-radius:6px;border:1px solid var(--border);">
                    <option value="1">First Quarter</option>
                    <option value="2">Second Quarter</option>
                    <option value="3">Final</option>
                </select>

                <button style="margin-left:auto" onclick="clearStorage()" class="delete-btn">Clear Saved</button>
            </div>

            <div id="average-display">No subjects added yet.</div>
            <div class="legend">Excluded rows (Homeroom, Student Organizations / Clubs) are shown but not included in
                the
                average.</div>

            <table id="grades-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th style="width:140px;">Grade (<span id="quarter-label">1st</span>)</th>
                        <th style="width:120px;">Status / Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        (function () {
            // State
            let subjects = []; // { name, firstQuarter, secondQuarter, finalGrade, isExcluded }
            let currentQuarter = '1'; // 1=first,2=second,3=final

            // Key for localStorage
            const STORAGE_KEY = 'stugrade_subjects_v1';

            // Exclusion detection regex (case-insensitive)
            const exclusionRegex = /\b(homeroom|home\s*room|student\s*organizations?|students?\s*org|students?\s*clubs?|organizations?\s*&\s*clubs?|student.*club|students?\s*extra)\b/i;

            // Helpers: read and write storage
            function saveToLocalStorage() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(subjects));
            }
            function loadFromLocalStorage() {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (raw) {
                    try {
                        subjects = JSON.parse(raw);
                    } catch (e) {
                        subjects = [];
                    }
                } else {
                    subjects = [];
                }
                renderTable();
            }

            // Process the pasted block text into subject objects
            window.processGrades = function processGrades() {
                const input = document.getElementById('grade-input').value;
                subjects = [];
                if (!input.trim()) return;

                // keep lines (no empty) but DON'T depend on bullets being in a specific line
                const lines = input
                    .replace(/\r/g, '')
                    .split('\n')
                    .map(l => l.trim())
                    .filter(Boolean);

                const norm = (s) => String(s || '').toLowerCase().replace(/\s+/g, ''); // remove all whitespace [web:117]
                const isTeacherLine = (s) => String(s || '').includes('â€¢'); // still useful anchor in your data
                const isHeaderMerged = (s) => {
                    const x = norm(s);
                    return x.includes('firstquarter') && x.includes('secondquarter') && x.includes('final');
                };

                const getGradeFromLine = (s) => {
                    const t = String(s || '').trim();
                    if (t === '-' || t === 'â€”') return null;
                    const m = t.match(/\d{1,3}/); // 0-999, we'll clamp later
                    if (!m) return null;
                    const n = Math.max(0, Math.min(100, parseInt(m[0], 10)));
                    return Number.isNaN(n) ? null : n;
                };

                for (let i = 0; i < lines.length; i++) {
                    const subjectName = lines[i];
                    const teacher = lines[i + 1];
                    const hdr = lines[i + 2];

                    if (!subjectName || !teacher || !hdr) continue;

                    // Pattern A (NEW): header merged then 3 grade-only lines
                    // Subject
                    // Teacher â€¢ date
                    // First QuarterSecond QuarterFINAL
                    // 96
                    // 95
                    // -
                    if (isTeacherLine(teacher) && isHeaderMerged(hdr)) {
                        const g1 = getGradeFromLine(lines[i + 3]);
                        const g2 = getGradeFromLine(lines[i + 4]);
                        const g3 = getGradeFromLine(lines[i + 5]);

                        subjects.push({
                            name: subjectName,
                            firstQuarter: g1,
                            secondQuarter: g2,
                            finalGrade: g3,
                            isExcluded: exclusionRegex.test(subjectName)
                        });

                        i += 5;
                        continue;
                    }

                    // Pattern B (OLD): the quarter lines themselves contain the grade
                    // Subject
                    // Teacher â€¢ date
                    // First Quarter ... 96
                    // Second Quarter ... 95
                    // Final ... -
                    const hdrOld = norm(hdr);
                    if (isTeacherLine(teacher) && hdrOld.includes('firstquarter')) {
                        const g1 = getGradeFromLine(lines[i + 2]);
                        const g2 = getGradeFromLine(lines[i + 3]);
                        const g3 = getGradeFromLine(lines[i + 4]);

                        subjects.push({
                            name: subjectName,
                            firstQuarter: g1,
                            secondQuarter: g2,
                            finalGrade: g3,
                            isExcluded: exclusionRegex.test(subjectName)
                        });

                        i += 4;
                        continue;
                    }
                }

                saveToLocalStorage();
                renderTable();
            };


            // Add a manual subject row
            window.addSubject = function addSubject() {
                subjects.push({
                    name: 'New Subject',
                    firstQuarter: null,
                    secondQuarter: null,
                    finalGrade: null,
                    isExcluded: false
                });
                saveToLocalStorage();
                renderTable();
            };

            // Delete a subject
            window.deleteSubject = function deleteSubject(index) {
                if (index >= 0 && index < subjects.length) {
                    subjects.splice(index, 1);
                    saveToLocalStorage();
                    renderTable();
                }
            };

            // Update subject name and recompute exclusion flag
            window.updateSubjectName = function updateSubjectName(index, name) {
                if (!subjects[index]) return;
                subjects[index].name = name;
                subjects[index].isExcluded = exclusionRegex.test(name);
                saveToLocalStorage();
                renderTable();
            };

            // Update grade for the current selected quarter
            window.updateGrade = function updateGrade(index, rawValue, el) {
                if (!subjects[index]) return;

                // allow only digits
                let cleaned = String(rawValue ?? "").replace(/[^\d]/g, "").slice(0, 3);
                let val = cleaned === "" ? null : parseInt(cleaned, 10);

                if (val !== null && !Number.isNaN(val)) {
                    if (val > 100) {
                        val = 100;

                        // Force the visible input value back to 100 immediately
                        if (el) el.value = "100";
                    } else if (val < 0) {
                        val = 0;
                        if (el) el.value = "0";
                    }
                } else {
                    val = null;
                }

                if (currentQuarter === '1') subjects[index].firstQuarter = val;
                if (currentQuarter === '2') subjects[index].secondQuarter = val;
                if (currentQuarter === '3') subjects[index].finalGrade = val;

                saveToLocalStorage();
                calculateAverage();
            };

            // Render the table UI
            function renderTable() {
                const tbody = document.querySelector('#grades-table tbody');
                tbody.innerHTML = '';
                subjects.forEach((sub, idx) => {
                    const tr = document.createElement('tr');
                    if (sub.isExcluded) tr.classList.add('excluded-row');

                    // Subject name cell (editable)
                    const nameCell = document.createElement('td');
                    const nameInput = document.createElement('input');
                    nameInput.type = 'text';
                    nameInput.value = sub.name || '';
                    nameInput.style.width = '100%';
                    nameInput.style.padding = '6px';
                    nameInput.style.borderRadius = '6px';
                    nameInput.style.border = '1px solid var(--border)';
                    nameInput.onchange = (e) => updateSubjectName(idx, e.target.value);
                    nameCell.appendChild(nameInput);
                    tr.appendChild(nameCell);

                    // Grade cell (depending on quarter)
                    const gradeCell = document.createElement('td');
                    const gradeInput = document.createElement('input');
                    gradeInput.className = 'grade-input';
                    gradeInput.type = 'number';
                    gradeInput.inputMode = 'numeric';  // better mobile keypad
                    gradeInput.min = '0';
                    gradeInput.max = '100';
                    gradeInput.step = '1';

                    let curVal = '';
                    if (currentQuarter === '1') curVal = sub.firstQuarter !== null && sub.firstQuarter !== undefined ? String(sub.firstQuarter) : '';
                    if (currentQuarter === '2') curVal = sub.secondQuarter !== null && sub.secondQuarter !== undefined ? String(sub.secondQuarter) : '';
                    if (currentQuarter === '3') curVal = sub.finalGrade !== null && sub.finalGrade !== undefined ? String(sub.finalGrade) : '';
                    gradeInput.value = curVal;
                    gradeInput.oninput = (e) => updateGrade(idx, e.target.value, e.target);
                    gradeInput.onpaste = (e) => {
                        e.preventDefault();
                        const pasted = e.clipboardData.getData('text');
                        updateGrade(idx, pasted);
                    };
                    gradeCell.appendChild(gradeInput);
                    tr.appendChild(gradeCell);

                    // Action / status cell
                    const actionCell = document.createElement('td');
                    if (sub.isExcluded) {
                        actionCell.innerHTML = '<span class="small">Excluded</span> ';
                    } else {
                        actionCell.innerHTML = '<span class="small">Included</span> ';
                    }
                    actionCell.innerHTML += `<button class="delete-btn" style="margin-left:8px" onclick="deleteSubject(${idx})">Delete</button>`;
                    tr.appendChild(actionCell);

                    tbody.appendChild(tr);
                });

                // Update quarter label
                const qLabel = document.getElementById('quarter-label');
                qLabel.textContent = (currentQuarter === '1' ? '1st' : (currentQuarter === '2' ? '2nd' : 'Final'));

                calculateAverage();
            }

            // Calculate average for the selected quarter, excluding excluded subjects
            function calculateAverage() {
                if (!subjects || subjects.length === 0) {
                    document.getElementById('average-display').textContent = 'No subjects added yet.';
                    return;
                }

                let total = 0;
                let count = 0;

                subjects.forEach(sub => {
                    if (sub.isExcluded) return; // skip excluded
                    let g = null;
                    if (currentQuarter === '1') g = sub.firstQuarter;
                    if (currentQuarter === '2') g = sub.secondQuarter;
                    if (currentQuarter === '3') g = sub.finalGrade;
                    if (g !== null && g !== undefined && !isNaN(g)) {
                        total += Number(g);
                        count++;
                    }
                });

                const display = document.getElementById('average-display');
                if (count === 0) {
                    display.textContent = 'No valid grades (for selected quarter) to calculate.';
                    return;
                }

                const avg = total / count;
                const rounded = Math.round(avg);
                let honorsText = '';
                if (rounded >= 98) honorsText = ' â€” With Highest Honors';
                else if (rounded >= 95) honorsText = ' â€” With High Honors';
                else if (rounded >= 90) honorsText = ' â€” With Honors';

                display.textContent = `Average Grade (${count} subjects): ${rounded}${honorsText}`;
            }

            // Handle quarter change
            document.getElementById('quarter-select').addEventListener('change', (e) => {
                currentQuarter = e.target.value;
                renderTable();
                // Save current state (in case grades were edited)
                saveToLocalStorage();
            });

            // Clear local storage
            window.clearStorage = function clearStorage() {
                if (confirm('Clear saved subjects from local storage?')) {
                    localStorage.removeItem(STORAGE_KEY);
                    subjects = [];
                    renderTable();
                }
            };

            loadFromLocalStorage();

            window.onload = function () { window.scrollTo(0, 0); };
        })();
    </script>
</body>

</html>
